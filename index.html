<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚ãŸã™ã¦ - WATASUTE</title>
  <meta
    name="description"
    content="ã‚ãŸã™ã¦ï¼ˆWATASUTEï¼‰ã¯ã€æœã‚„é«ªå‹ã€ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ã‚’è‡ªç”±ã«ç€ã›æ›¿ãˆã¦éŠã¹ã‚‹ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¢ãƒã‚¿ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼å‘ã‘ã®ã‚¢ã‚¤ãƒ†ãƒ ç™»éŒ²ã‚‚æº–å‚™ä¸­ã€‚"
  />
  <style>
    /* ========== å…±é€šãƒªã‚»ãƒƒãƒˆ ========== */
    * { box-sizing: border-box; }

    body {
      font-family: "Helvetica Neue", Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #fcf0f5;
      background-image: url("assets/bg_pattern.png");
      background-size: 100px;
      color: #333;
      display: flex;
      justify-content: center;
      min-height: 100vh;
      overflow-x: hidden;
    }

    img { max-width: 100%; height: auto; vertical-align: bottom; }
    button { font-family: inherit; }

    /* ========== ã‚¢ãƒ—ãƒªæ  ========== */
    .app {
      width: 100%;
      max-width: 480px;
      min-height: 100vh;
      background: rgba(255, 255, 255, 0.97);
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
    }

    .app-inner { width: 100%; padding: 0 16px 32px; }

    @media (min-width: 900px) {
      .app { max-width: 640px; transform: scale(1.03); transform-origin: top center; }
      #avatar-display { width: 340px; height: 340px; }
      .item-list { grid-template-columns: repeat(5, 1fr); }
    }

    /* ========== ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆå…±é€šï¼‰ ========== */
    header {
      width: 100%;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .logo { width: 220px; max-width: 70%; }

    .hamburger-menu {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      width: 30px;
      height: 24px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 0;
      border: none;
      background: none;
      z-index: 20;
    }

    .hamburger-menu span {
      display: block;
      width: 100%;
      height: 3px;
      background-color: #333;
      border-radius: 3px;
    }

    .drawer-menu {
      position: absolute;
      left: 12px;
      top: 54px;
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      padding: 10px 14px;
      display: none;
      z-index: 15;
    }

    .drawer-menu.open { display: block; }

    .drawer-menu a {
      display: block;
      font-size: 0.85rem;
      color: #333;
      text-decoration: none;
      padding: 5px 0;
    }

    .drawer-menu a + a { border-top: 1px solid #eee; }

    /* ========== HOME ç”»é¢ ========== */
    #home-screen { display: block; }

    .main-visual { width: 100%; display: block; }

    .header-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 16px 0;
    }

    .header-btn { width: 45%; max-width: 160px; cursor: pointer; }

    .news-ticker {
      width: 100%;
      height: 40px;
      background-image: url("assets/bg_news.png");
      background-size: 100% 100%;
      display: flex;
      align-items: center;
      overflow: hidden;
      margin: 0 auto 18px auto;
      font-size: 0.8rem;
      color: #333;
      white-space: nowrap;
      border-radius: 5px;
    }

    .news-content {
      display: inline-block;
      padding-left: 100%;
      animation: marquee 15s linear infinite;
    }

    @keyframes marquee {
      0% { transform: translate(0, 0); }
      100% { transform: translate(-100%, 0); }
    }

    .start-area { width: 100%; text-align: center; margin: 12px 0 24px; }
    .start-title { font-weight: bold; font-size: 1.2rem; margin-bottom: 6px; }

    .btn-start {
      width: 80%;
      max-width: 320px;
      display: block;
      margin: 0 auto;
      cursor: pointer;
      transition: transform 0.1s;
    }

    .btn-start:active { transform: scale(0.95); }

    .card {
      width: 100%;
      background: #d0f0f0;
      padding: 16px 12px;
      border-radius: 15px;
      margin-bottom: 18px;
      position: relative;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
      border: 1px solid rgba(0, 0, 0, 0.03);
    }

    .card-title { font-weight: bold; margin: 0 0 10px; color: #333; font-size: 0.9rem; }
    .card-title.center { text-align: center; }

    .slider-content {
      display: flex;
      justify-content: center;
      gap: 10px;
      overflow-x: auto;
      width: 100%;
      padding-bottom: 6px;
      scrollbar-width: none;
    }

    .slider-content::-webkit-scrollbar { display: none; }

    .thumb-img {
      width: 80px;
      height: 100px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid white;
      background: #fff;
      flex-shrink: 0;
    }

    .item-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }

    .item-box {
      background: #ffffff;
      border-radius: 8px;
      padding: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .sns-area { width: 100%; margin: 30px 0 20px; text-align: center; }
    .sns-title { font-weight: bold; margin-bottom: 6px; }

    .sns-icons { display: flex; justify-content: center; gap: 20px; margin-top: 8px; }
    .sns-icon { width: 50px; cursor: pointer; }

    footer {
      width: 100%;
      background: #d0f0f0;
      padding: 24px 16px 30px;
      text-align: center;
      font-size: 0.8rem;
      margin-top: auto;
      box-sizing: border-box;
    }

    .footer-logo { font-weight: bold; margin-bottom: 10px; }

    .footer-links {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      text-align: left;
      width: 100%;
      margin: 0 auto 20px;
    }

    .footer-link { color: #555; text-decoration: none; }

    .banner-creator { width: 90%; max-width: 320px; margin-bottom: 10px; }

    /* ========== ç€ã›æ›¿ãˆç”»é¢ ========== */
    #maker-screen {
      display: none;
      padding: 10px 16px 24px;
      background: #ffe5ef;
      flex: 1;
    }

    .maker-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .maker-title { font-weight: bold; font-size: 1.1rem; }

    .maker-header-btn {
      font-size: 0.75rem;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #ddd;
      background: #fff;
      color: #555;
      cursor: pointer;
    }

    .maker-main-top {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 10px;
    }

    .avatar-wrapper { flex: 1; display: flex; justify-content: center; }

    #avatar-display {
      width: 260px;
      height: 260px;
      background-color: #fff;
      border-radius: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      position: relative;
      overflow: hidden;
      background-image: linear-gradient(45deg, #eee 25%, transparent 25%, transparent 75%, #eee 75%, #eee),
        linear-gradient(45deg, #eee 25%, transparent 25%, transparent 75%, #eee 75%, #eee);
      background-size: 20px 20px;
      background-position: 0 0, 10px 10px;
    }

    $1
    /* â˜…è¿½åŠ ï¼šã‚­ãƒ£ãƒ©å…¨ä½“ã‚’å‹•ã‹ã™ï¼ˆãƒ‰ãƒ©ãƒƒã‚°/ãƒ”ãƒ³ãƒï¼‰ */
    #avatar-group {
      position: absolute;
      inset: 0;
      z-index: 10;
      transform: translate(0px, 0px) scale(1);
      transform-origin: 50% 50%;
      touch-action: none; /* ãƒ”ãƒ³ãƒ/ãƒ‰ãƒ©ãƒƒã‚°ã‚’JSã§æ‰±ã† */
      cursor: grab;
    }
    #avatar-group:active { cursor: grabbing; }

    .avatar-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      pointer-events: none;
    }

    #layer-background { z-index: 5; }
    #layer-hair-back { z-index: 10; }
    #layer-body { z-index: 20; }
    #layer-eyes { z-index: 30; }
    #layer-mouth { z-index: 35; }
    #layer-outfit { z-index: 40; }
    #layer-hair-front { z-index: 50; }
    #layer-accessory { z-index: 60; }
    #layer-frame { z-index: 100; }

    .btn-trash {
      background: #ffffff;
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 6px 10px;
      font-size: 0.75rem;
      color: #555;
      cursor: pointer;
      white-space: nowrap;
    }

    .maker-actions {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin: 12px 0 14px;
      flex-wrap: wrap;
    }

    .btn-big {
      min-width: 120px;
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      font-size: 0.9rem;
      font-weight: bold;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .btn-save-main { background: #ff9fb8; color: #fff; }

    .btn-share-main {
      background: #ffffff;
      color: #4a82ff;
      border: 1px solid #4a82ff;
    }

    #controls {
      width: 100%;
      background: #fff;
      padding: 12px 12px 16px;
      border-radius: 18px;
      box-shadow: 0 -1px 6px rgba(0, 0, 0, 0.08);
    }

    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
      overflow-x: auto;
      padding-bottom: 4px;
      scrollbar-width: none;
    }

    .tabs::-webkit-scrollbar { display: none; }

    .tab-btn {
      background: #f0f0f0;
      border: none;
      padding: 6px 12px;
      border-radius: 20px;
      font-weight: bold;
      color: #888;
      white-space: nowrap;
      cursor: pointer;
      font-size: 0.8rem;
    }

    .tab-btn.active { background: #ff8fab; color: #fff; }

    .item-list {
      display: none;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      max-height: 280px;
      overflow-y: auto;
      padding-bottom: 8px;
    }

    .item-list.active { display: grid; }

    .item-btn {
      aspect-ratio: 1;
      background-color: #f9f9f9;
      border: 2px solid #eee;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      flex-direction: column;
      text-align: center;
      padding: 4px;
      word-break: break-all;
      cursor: pointer;
    }

    .item-btn:hover,
    .item-btn:active { border-color: #ff8fab; background-color: #fff0f5; }
  </style>
</head>
<body>
  <div class="app">
    <!-- ========== HOME ç”»é¢ ========== -->
    <div id="home-screen">
      <header>
        <button
          class="hamburger-menu"
          type="button"
          aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã"
          aria-expanded="false"
          onclick="toggleMenu()"
        >
          <span></span>
          <span></span>
          <span></span>
        </button>

        <img src="assets/logo.png" class="logo" alt="WATASUTE ãƒ­ã‚´" />

        <nav id="drawer-menu" class="drawer-menu" aria-hidden="true">
          <a href="#start-area">è‡ªåˆ†ã®ç€ã›æ›¿ãˆ</a>
          <a href="#recommend">ãŠã™ã™ã‚ã‚¢ã‚¤ãƒ†ãƒ </a>
          <a href="#sns">å…¬å¼SNS</a>
          <a href="#footer">ãŠå•ã„åˆã‚ã›</a>
        </nav>
      </header>

      <img
        src="assets/main_visual.png"
        class="main-visual"
        alt="ã‚ãŸã™ã¦ ãƒ¡ã‚¤ãƒ³ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«"
      />

      <div class="app-inner">
        <div class="header-buttons">
          <img src="assets/btn_Q.png" class="header-btn" alt="ã‚ãŸã™ã¦ã¨ã¯" />
          <img src="assets/btn_Howto.png" class="header-btn" alt="éŠã³æ–¹ How to" />
        </div>

        <div class="news-ticker" aria-label="ãŠçŸ¥ã‚‰ã›">
          <div class="news-content">
            ğŸ‰ ã‚ãŸã™ã¦ãƒ—ãƒ¬ã‚ªãƒ¼ãƒ—ãƒ³ï¼ ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼å‹Ÿé›†ä¸­ï¼ æ–°ç€ã‚¢ã‚¤ãƒ†ãƒ ç¶šã€…è¿½åŠ äºˆå®šï¼
          </div>
        </div>

        <section id="start-area" class="start-area">
          <div class="start-title">è‡ªåˆ†ã®ç€ã›æ›¿ãˆ</div>
          <img
            src="assets/btn_start.png"
            class="btn-start"
            alt="ä»Šã™ãä½œã‚‹"
            onclick="goToMaker()"
          />
        </section>

        <section class="card">
          <h2 class="card-title center">æœ¬æ—¥ã®ãŠã™ã™ã‚ã‚³ãƒ¼ãƒ‡</h2>
          <div class="slider-content">
            <img src="assets/thumb_rec_1.png" class="thumb-img" alt="ãŠã™ã™ã‚ã‚³ãƒ¼ãƒ‡1" />
            <img src="assets/thumb_rec_2.png" class="thumb-img" alt="ãŠã™ã™ã‚ã‚³ãƒ¼ãƒ‡2" />
            <img src="assets/thumb_rec_3.png" class="thumb-img" alt="ãŠã™ã™ã‚ã‚³ãƒ¼ãƒ‡3" />
          </div>
        </section>

        <section class="card">
          <h2 class="card-title">æœ€å¾Œã®ç€ã›æ›¿ãˆå±¥æ­´</h2>
          <div class="slider-content">
            <img src="assets/thumb_history.png" class="thumb-img" alt="æœ€å¾Œã®ç€ã›æ›¿ãˆ" />
          </div>
        </section>

        <section id="recommend" class="card">
          <h2 class="card-title">ã‚ªã‚¹ã‚¹ãƒ¡</h2>
          <div class="item-grid">
            <div class="item-box"><img src="assets/item_top_4.png" alt="ãŠã™ã™ã‚ã‚¢ã‚¤ãƒ†ãƒ 1" /></div>
            <div class="item-box"><img src="assets/item_top_5.png" alt="ãŠã™ã™ã‚ã‚¢ã‚¤ãƒ†ãƒ 2" /></div>
            <div class="item-box"><img src="assets/item_top_6.png" alt="ãŠã™ã™ã‚ã‚¢ã‚¤ãƒ†ãƒ 3" /></div>
          </div>
        </section>

        <section id="sns" class="sns-area">
          <div class="sns-title">OfficialSNS</div>
          <div class="sns-icons">
            <img src="assets/icon_insta.png" class="sns-icon" alt="Instagram" />
            <img src="assets/icon_x.png" class="sns-icon" alt="Xï¼ˆæ—§Twitterï¼‰" />
            <img src="assets/icon_line.png" class="sns-icon" alt="LINEå…¬å¼" />
          </div>
          <div style="margin-top: 10px; font-weight: bold">Follow Us! â¤´</div>
        </section>
      </div>

      <footer id="footer">
        <div class="footer-logo">WATASUTE</div>
        <div class="footer-links">
          <a href="#" class="footer-link">ãŠã™ã™ã‚</a>
          <a href="#" class="footer-link">gallery</a>
          <a href="#" class="footer-link">ãƒ˜ãƒ«ãƒ—</a>
          <a href="#" class="footer-link">ã‚ˆãã‚ã‚‹è³ªå•</a>
          <a href="#" class="footer-link">ã‚¬ã‚¤ãƒ‰</a>
          <a href="#" class="footer-link">ãŠå•ã„åˆã‚ã›</a>
          <a href="#" class="footer-link">ãƒ¡ãƒ‡ã‚£ã‚¢é–¢é€£</a>
        </div>
        <img src="assets/banner_creator.png" class="banner-creator" alt="ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã•ã‚“å‹Ÿé›†ä¸­ãƒãƒŠãƒ¼" />
        <div style="margin-top: 6px">Â© WATASUTE</div>
      </footer>
    </div>

    <!-- ========== ç€ã›æ›¿ãˆç”»é¢ ========== -->
    <div id="maker-screen">
      <header class="maker-header">
        <button type="button" class="maker-header-btn" onclick="goHome()">â† ãƒã‚¤ãƒšãƒ¼ã‚¸</button>
        <div class="maker-title">è‡ªåˆ†ã®ç€ã›æ›¿ãˆ</div>
        <button type="button" class="maker-header-btn">æ‰€æŒã‚¢ã‚¤ãƒ†ãƒ </button>
      </header>

      <div class="maker-main-top">
        <div class="avatar-wrapper">
          <div id="avatar-display">
            <!-- â˜…ã‚«ãƒ¡ãƒ©æ˜ åƒï¼ˆæ’®å½±ãƒ¢ãƒ¼ãƒ‰ã§è¡¨ç¤ºï¼‰ -->
            <video id="camera" autoplay playsinline muted></video>

            <!-- â˜…ã‚­ãƒ£ãƒ©ã‚’ã¾ã¨ã‚ã¦å‹•ã‹ã™ç®±ï¼ˆãƒ‰ãƒ©ãƒƒã‚°/ãƒ”ãƒ³ãƒå¯¾è±¡ï¼‰ -->
            <div id="avatar-group">
              <img id="layer-background" class="avatar-layer" src="" alt="" />
              <img id="layer-hair-back" class="avatar-layer" src="assets/hair1_back.png" alt="" />
              <img id="layer-body" class="avatar-layer" src="assets/body.png" alt="ç´ ä½“" />
              <img id="layer-eyes" class="avatar-layer" src="assets/eyes1.png" alt="" />
              <img id="layer-mouth" class="avatar-layer" src="assets/mouth1.png" alt="" />
              <img id="layer-outfit" class="avatar-layer" src="assets/outfit1.png" alt="" />
              <img id="layer-hair-front" class="avatar-layer" src="assets/hair1_front.png" alt="" />
              <img id="layer-accessory" class="avatar-layer" src="" alt="" />
              <img id="layer-frame" class="avatar-layer" src="" alt="" />
            </div>
          </div>
        </div>

        <button class="btn-trash" type="button" onclick="resetAvatar()">å…¨éƒ¨è„±ãŒã™</button>
      </div>

      <div class="maker-actions">
        <!-- èƒŒæ™¯ãªã—ä¿å­˜ï¼ˆå¾“æ¥ï¼‰ -->
        <button class="btn-big btn-share-main" type="button" onclick="downloadImage()">â™¡ ä¿å­˜</button>

        <!-- â˜…æ’®å½±å°ç·š -->
        <button class="btn-big btn-share-main" type="button" onclick="toggleShootMode()">ğŸ“· æ’®å½±ãƒ¢ãƒ¼ãƒ‰</button>
        <button class="btn-big btn-share-main" type="button" onclick="startCamera()">ã‚«ãƒ¡ãƒ©ON</button>
        <button class="btn-big btn-share-main" type="button" onclick="switchCamera()">ğŸ”„ åˆ‡æ›¿</button>
        <button class="btn-big btn-save-main" type="button" onclick="captureAndDownload()">ğŸ“¸ æ’®å½±ã—ã¦DL</button>
      </div>

      <div id="controls">
        <div class="tabs">
          <button class="tab-btn active" type="button" onclick="showTab(this, 'hair-front')">å‰é«ª</button>
          <button class="tab-btn" type="button" onclick="showTab(this, 'hair-back')">å¾Œé«ª</button>
          <button class="tab-btn" type="button" onclick="showTab(this, 'eyes')">ç›®</button>
          <button class="tab-btn" type="button" onclick="showTab(this, 'mouth')">å£</button>
          <button class="tab-btn" type="button" onclick="showTab(this, 'outfit')">æœ</button>
          <button class="tab-btn" type="button" onclick="showTab(this, 'accessory')">ã‚¢ã‚¯ã‚»</button>
        </div>

        <!-- å‰é«ª -->
        <div id="tab-hair-front" class="item-list active">
          <button class="item-btn" type="button" onclick="setPart('layer-hair-front', 'hair1_front')">å‰é«ª1</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-front', 'hair2_front')">å‰é«ª2</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-front', 'hair3_front')">å‰é«ª3</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-front', 'hair4_front')">å‰é«ª4</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-front', 'hair5_front')">å‰é«ª5</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-front', 'hair6_front')">å‰é«ª6</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-front', 'hair7_front')">å‰é«ª7</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-front', 'hair8_front')">å‰é«ª8</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-front', 'hair9_front')">å‰é«ª9</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-front', 'hair10_front')">å‰é«ª10</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-front', 'hair11_front')">å‰é«ª11</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-front', 'hair12_front')">å‰é«ª12</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-front', null)">ãªã—</button>
        </div>

        <!-- å¾Œé«ª -->
        <div id="tab-hair-back" class="item-list">
          <button class="item-btn" type="button" onclick="setPart('layer-hair-back', 'hair1_back')">å¾Œé«ª1</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-back', 'hair2_back')">å¾Œé«ª2</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-back', 'hair3_back')">å¾Œé«ª3</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-back', 'hair4_back')">å¾Œé«ª4</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-back', 'hair5_back')">å¾Œé«ª5</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-back', 'hair6_back')">å¾Œé«ª6</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-back', 'hair7_back')">å¾Œé«ª7</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-back', 'hair8_back')">å¾Œé«ª8</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-back', 'hair9_back')">å¾Œé«ª9</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-back', 'hair10_back')">å¾Œé«ª10</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-back', 'hair11_back')">å¾Œé«ª11</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-back', 'hair12_back')">å¾Œé«ª12</button>
          <button class="item-btn" type="button" onclick="setPart('layer-hair-back', null)">ãªã—</button>
        </div>

        <!-- ç›® -->
        <div id="tab-eyes" class="item-list">
          <button class="item-btn" type="button" onclick="setPart('layer-eyes', 'eyes1')">ç›®1</button>
          <button class="item-btn" type="button" onclick="setPart('layer-eyes', 'eyes2')">ç›®2</button>
          <button class="item-btn" type="button" onclick="setPart('layer-eyes', 'eyes3')">ç›®3</button>
          <button class="item-btn" type="button" onclick="setPart('layer-eyes', 'eyes4')">ç›®4</button>
          <button class="item-btn" type="button" onclick="setPart('layer-eyes', 'eyes5')">ç›®5</button>
          <button class="item-btn" type="button" onclick="setPart('layer-eyes', 'eyes6')">ç›®6</button>
          <button class="item-btn" type="button" onclick="setPart('layer-eyes', 'eyes7')">ç›®7</button>
          <button class="item-btn" type="button" onclick="setPart('layer-eyes', 'eyes8')">ç›®8</button>
          <button class="item-btn" type="button" onclick="setPart('layer-eyes', 'eyes9')">ç›®9</button>
          <button class="item-btn" type="button" onclick="setPart('layer-eyes', 'eyes10')">ç›®10</button>
          <button class="item-btn" type="button" onclick="setPart('layer-eyes', 'eyes11')">ç›®11</button>
          <button class="item-btn" type="button" onclick="setPart('layer-eyes', 'eyes12')">ç›®12</button>
          <button class="item-btn" type="button" onclick="setPart('layer-eyes', 'eyes13')">ç›®13</button>
          <button class="item-btn" type="button" onclick="setPart('layer-eyes', 'eyes14')">ç›®14</button>
          <button class="item-btn" type="button" onclick="setPart('layer-eyes', null)">ãªã—</button>
        </div>

        <!-- å£ -->
        <div id="tab-mouth" class="item-list">
          <button class="item-btn" type="button" onclick="setPart('layer-mouth', 'mouth1')">å£1</button>
          <button class="item-btn" type="button" onclick="setPart('layer-mouth', 'mouth2')">å£2</button>
          <button class="item-btn" type="button" onclick="setPart('layer-mouth', 'mouth3')">å£3</button>
          <button class="item-btn" type="button" onclick="setPart('layer-mouth', 'mouth4')">å£4</button>
          <button class="item-btn" type="button" onclick="setPart('layer-mouth', 'mouth5')">å£5</button>
          <button class="item-btn" type="button" onclick="setPart('layer-mouth', 'mouth6')">å£6</button>
          <button class="item-btn" type="button" onclick="setPart('layer-mouth', null)">ãªã—</button>
        </div>

        <!-- æœ -->
        <div id="tab-outfit" class="item-list">
          <button class="item-btn" type="button" onclick="setPart('layer-outfit', 'outfit1')">æœ1</button>
          <button class="item-btn" type="button" onclick="setPart('layer-outfit', 'outfit2')">æœ2</button>
          <button class="item-btn" type="button" onclick="setPart('layer-outfit', 'outfit3')">æœ3</button>
          <button class="item-btn" type="button" onclick="setPart('layer-outfit', 'outfit4')">æœ4</button>
          <button class="item-btn" type="button" onclick="setPart('layer-outfit', 'outfit5')">æœ5</button>
          <button class="item-btn" type="button" onclick="setPart('layer-outfit', 'outfit6')">æœ6</button>
          <button class="item-btn" type="button" onclick="setPart('layer-outfit', 'outfit7')">æœ7</button>
          <button class="item-btn" type="button" onclick="setPart('layer-outfit', 'outfit8')">æœ8</button>
          <button class="item-btn" type="button" onclick="setPart('layer-outfit', 'outfit9')">æœ9</button>
          <button class="item-btn" type="button" onclick="setPart('layer-outfit', 'outfit10')">æœ10</button>
          <button class="item-btn" type="button" onclick="setPart('layer-outfit', 'outfit11')">æœ11</button>
          <button class="item-btn" type="button" onclick="setPart('layer-outfit', 'outfit12')">æœ12</button>
          <button class="item-btn" type="button" onclick="setPart('layer-outfit', 'outfit13')">æœ13</button>
          <button class="item-btn" type="button" onclick="setPart('layer-outfit', 'outfit14')">æœ14</button>
          <button class="item-btn" type="button" onclick="setPart('layer-outfit', 'outfit15')">æœ15</button>
          <button class="item-btn" type="button" onclick="setPart('layer-outfit', null)">è„±ã</button>
        </div>

        <!-- ã‚¢ã‚¯ã‚»ã‚µãƒª -->
        <div id="tab-accessory" class="item-list">
          <button class="item-btn" type="button" onclick="setPart('layer-accessory', 'accessory1')">ã‚¢ã‚¯ã‚»1</button>
          <button class="item-btn" type="button" onclick="setPart('layer-accessory', 'accessory2')">ã‚¢ã‚¯ã‚»2</button>
          <button class="item-btn" type="button" onclick="setPart('layer-accessory', 'accessory3')">ã‚¢ã‚¯ã‚»3</button>
          <button class="item-btn" type="button" onclick="setPart('layer-accessory', null)">ãªã—</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    function goToMaker() {
      document.getElementById("home-screen").style.display = "none";
      document.getElementById("maker-screen").style.display = "block";
      window.scrollTo(0, 0);

      // â˜…åˆå›ã ã‘ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼åˆæœŸåŒ–
      if (!window.__watasuteGesturesReady) {
        setupAvatarGestures();
        window.__watasuteGesturesReady = true;
      }
    }

    function goHome() {
      stopCamera();
      setShootMode(false);
      document.getElementById("maker-screen").style.display = "none";
      document.getElementById("home-screen").style.display = "block";
      window.scrollTo(0, 0);
    }

    function toggleMenu() {
      const btn = document.querySelector(".hamburger-menu");
      const menu = document.getElementById("drawer-menu");
      const isOpen = menu.classList.toggle("open");
      btn.setAttribute("aria-expanded", isOpen ? "true" : "false");
      menu.setAttribute("aria-hidden", isOpen ? "false" : "true");
    }

    function showTab(button, tabName) {
      document.querySelectorAll(".tab-btn").forEach((btn) => btn.classList.remove("active"));
      document.querySelectorAll(".item-list").forEach((list) => list.classList.remove("active"));
      button.classList.add("active");
      document.getElementById("tab-" + tabName).classList.add("active");
    }

    function setPart(layerId, imageName) {
      const layer = document.getElementById(layerId);
      if (imageName) {
        layer.src = `assets/${imageName}.png`;
        layer.style.display = "block";
      } else {
        layer.src = "";
        layer.style.display = "none";
      }
    }

    function resetAvatar() {
      const layers = document.querySelectorAll(".avatar-layer");
      layers.forEach((img) => {
        if (img.id !== "layer-body") {
          img.style.display = "none";
          img.src = "";
        }
      });
    }

    // ========== æ—¢å­˜ï¼šèƒŒæ™¯ãªã—ä¿å­˜ ==========
    function downloadImage() {
      try {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        const bodyImg = document.getElementById("layer-body");
        if (!bodyImg || bodyImg.naturalWidth === 0) {
          canvas.width = 1000;
          canvas.height = 1500;
        } else {
          canvas.width = bodyImg.naturalWidth;
          canvas.height = bodyImg.naturalHeight;
        }
        const layerIds = [
          "layer-background",
          "layer-hair-back",
          "layer-body",
          "layer-eyes",
          "layer-mouth",
          "layer-outfit",
          "layer-hair-front",
          "layer-accessory",
          "layer-frame",
        ];
        let itemsDrawn = 0;
        layerIds.forEach((id) => {
          const img = document.getElementById(id);
          if (img && img.style.display !== "none" && img.src && img.naturalWidth > 0) {
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            itemsDrawn++;
          }
        });
        if (itemsDrawn === 0) {
          alert("ç”»åƒãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“");
          return;
        }
        const link = document.createElement("a");
        link.download = "watasute_avatar.png";
        link.href = canvas.toDataURL("image/png");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } catch (e) {
        alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + e.message);
      }
    }

    // ========== â˜…è¿½åŠ ï¼šæ’®å½±ãƒ¢ãƒ¼ãƒ‰ï¼ˆã‚«ãƒ¡ãƒ©ï¼‰ ==========
    let cameraStream = null;
    let facingMode = "user"; // "environment" ã§èƒŒé¢
    let shootMode = false;

    // ===============================
    // â˜…ã‚­ãƒ£ãƒ©ç§»å‹•ãƒ»æ‹¡å¤§ç¸®å°ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ”ãƒ³ãƒï¼‰
    // ===============================
    const avatarTransform = { x: 0, y: 0, scale: 1 };
    const pointers = new Map();
    let gestureStart = null;

    function applyAvatarTransform() {
      const group = document.getElementById("avatar-group");
      if (!group) return;
      group.style.transform = `translate(${avatarTransform.x}px, ${avatarTransform.y}px) scale(${avatarTransform.scale})`;
    }

    function clampScale(s) {
      return Math.min(3, Math.max(0.4, s));
    }

    function setupAvatarGestures() {
      const group = document.getElementById("avatar-group");
      if (!group) return;

      group.addEventListener("pointerdown", (e) => {
        group.setPointerCapture(e.pointerId);
        pointers.set(e.pointerId, { x: e.clientX, y: e.clientY });

        if (pointers.size === 1) {
          gestureStart = {
            type: "drag",
            x0: avatarTransform.x,
            y0: avatarTransform.y,
            px: e.clientX,
            py: e.clientY,
          };
        } else if (pointers.size === 2) {
          const pts = Array.from(pointers.values());
          const dx = pts[0].x - pts[1].x;
          const dy = pts[0].y - pts[1].y;
          const dist = Math.hypot(dx, dy);
          const mid = { x: (pts[0].x + pts[1].x) / 2, y: (pts[0].y + pts[1].y) / 2 };
          gestureStart = {
            type: "pinch",
            dist,
            mid,
            scale0: avatarTransform.scale,
            x0: avatarTransform.x,
            y0: avatarTransform.y,
          };
        }
      });

      group.addEventListener("pointermove", (e) => {
        if (!pointers.has(e.pointerId) || !gestureStart) return;
        pointers.set(e.pointerId, { x: e.clientX, y: e.clientY });

        if (pointers.size === 1 && gestureStart.type === "drag") {
          const dx = e.clientX - gestureStart.px;
          const dy = e.clientY - gestureStart.py;
          avatarTransform.x = gestureStart.x0 + dx;
          avatarTransform.y = gestureStart.y0 + dy;
          applyAvatarTransform();
        }

        if (pointers.size === 2 && gestureStart.type === "pinch") {
          const pts = Array.from(pointers.values());
          const dx = pts[0].x - pts[1].x;
          const dy = pts[0].y - pts[1].y;
          const dist = Math.hypot(dx, dy);
          const scale = clampScale(gestureStart.scale0 * (dist / gestureStart.dist));

          const mid = { x: (pts[0].x + pts[1].x) / 2, y: (pts[0].y + pts[1].y) / 2 };
          const mdx = mid.x - gestureStart.mid.x;
          const mdy = mid.y - gestureStart.mid.y;

          avatarTransform.scale = scale;
          avatarTransform.x = gestureStart.x0 + mdx;
          avatarTransform.y = gestureStart.y0 + mdy;
          applyAvatarTransform();
        }
      });

      function endPointer(e) {
        pointers.delete(e.pointerId);
        if (pointers.size === 0) gestureStart = null;
        if (pointers.size === 1) {
          const pt = Array.from(pointers.values())[0];
          gestureStart = {
            type: "drag",
            x0: avatarTransform.x,
            y0: avatarTransform.y,
            px: pt.x,
            py: pt.y,
          };
        }
      }

      group.addEventListener("pointerup", endPointer);
      group.addEventListener("pointercancel", endPointer);

      // åˆæœŸåæ˜ 
      applyAvatarTransform();
    }

    function setShootMode(on) {
      shootMode = on;
      const video = document.getElementById("camera");
      if (!video) return;
      video.style.display = shootMode ? "block" : "none";
    }

    function toggleShootMode() {
      setShootMode(!shootMode);
    }

    async function startCamera() {
      try {
        const video = document.getElementById("camera");
        if (!video) return alert("cameraè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
        setShootMode(true);

        if (cameraStream) return;

        cameraStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode },
          audio: false,
        });

        video.srcObject = cameraStream;
        await video.play();
      } catch (e) {
        alert("ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã§ãã¾ã›ã‚“ã§ã—ãŸ: " + e.message);
      }
    }

    function stopCamera() {
      if (!cameraStream) return;
      cameraStream.getTracks().forEach((t) => t.stop());
      cameraStream = null;
      const video = document.getElementById("camera");
      if (video) video.srcObject = null;
    }

    async function switchCamera() {
      facingMode = facingMode === "user" ? "environment" : "user";
      stopCamera();
      await startCamera();
    }

    function captureAndDownload() {
      try {
        const stage = document.getElementById("avatar-display");
        const video = document.getElementById("camera");

        if (!video || !video.srcObject) {
          alert("å…ˆã«ã€Œã‚«ãƒ¡ãƒ©ONã€ã‚’æŠ¼ã—ã¦ãã ã•ã„");
          return;
        }

        const rect = stage.getBoundingClientRect();
        const stageW = Math.max(1, Math.round(rect.width));
        const stageH = Math.max(1, Math.round(rect.height));

        const dpr = window.devicePixelRatio || 1;
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = Math.round(stageW * dpr);
        canvas.height = Math.round(stageH * dpr);
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0); // CSS pxåŸºæº–

        // â‘  èƒŒæ™¯ï¼švideoãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆcoverï¼‰
        drawVideoCover(ctx, video, stageW, stageH);

        // â‘¡ ã‚­ãƒ£ãƒ©ã®ç§»å‹•ãƒ»æ‹¡å¤§ã‚’åæ˜ ã—ã¦ãƒ¬ã‚¤ãƒ¤ãƒ¼æç”»
        ctx.save();
        ctx.translate(stageW / 2 + avatarTransform.x, stageH / 2 + avatarTransform.y);
        ctx.scale(avatarTransform.scale, avatarTransform.scale);
        ctx.translate(-stageW / 2, -stageH / 2);

        const layerIds = [
          "layer-background",
          "layer-hair-back",
          "layer-body",
          "layer-eyes",
          "layer-mouth",
          "layer-outfit",
          "layer-hair-front",
          "layer-accessory",
          "layer-frame",
        ];

        let itemsDrawn = 0;
        layerIds.forEach((id) => {
          const img = document.getElementById(id);
          if (img && img.style.display !== "none" && img.src && img.naturalWidth > 0) {
            ctx.drawImage(img, 0, 0, stageW, stageH);
            itemsDrawn++;
          }
        });

        ctx.restore();

        if (itemsDrawn === 0) {
          alert("ç”»åƒãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“");
          return;
        }

        // â‘¢ DL
        const link = document.createElement("a");
        link.download = "watasute_shot.png";
        link.href = canvas.toDataURL("image/png");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } catch (e) {
        alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + e.message);
      }
    }

    function drawVideoCover(ctx, video, dstW, dstH) {
      const vw = video.videoWidth;
      const vh = video.videoHeight;
      if (!vw || !vh) {
        ctx.drawImage(video, 0, 0, dstW, dstH);
        return;
      }

      const videoRatio = vw / vh;
      const canvasRatio = dstW / dstH;

      let sx, sy, sw, sh;

      if (videoRatio > canvasRatio) {
        sh = vh;
        sw = Math.floor(vh * canvasRatio);
        sx = Math.floor((vw - sw) / 2);
        sy = 0;
      } else {
        sw = vw;
        sh = Math.floor(vw / canvasRatio);
        sx = 0;
        sy = Math.floor((vh - sh) / 2);
      }

      ctx.drawImage(video, sx, sy, sw, sh, 0, 0, dstW, dstH);
    }
  </script>
</body>
</html>
